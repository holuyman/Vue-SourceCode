{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/initMixin.js","../src/index.js"],"sourcesContent":["let oldArrayMethods=Array.prototype;\r\n\r\nexport let ArrayMethods=Object.create(Array.prototype)\r\nlet methods=[\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'unshift',\r\n    'splice',\r\n    'sort',\r\n    'reverse'\r\n]\r\nmethods.forEach(method=>{\r\n     ArrayMethods[method]=function(...args){\r\n       let result=  oldArrayMethods[method].call(this,...args)\r\n       //在这里重新为新的监听\r\n       let inserted;\r\n       switch(method){\r\n           case 'push':\r\n               case 'unshift':\r\n                inserted=args\r\n                break;\r\n                case 'splice':\r\n                    inserted=args.slice(2)\r\n                    default:\r\n                    break;\r\n       }\r\n       if(inserted){\r\n           this.__ob__.observeArray(inserted)\r\n       }\r\n       return result\r\n     }\r\n})","import { ArrayMethods } from \"./array\"\r\n\r\nclass Observer{\r\n    constructor(value){\r\n          // value.__ob__=this;//如果这样写会导致死循环\r\n          Object.defineProperty(value,'__ob__',{\r\n            value:this,\r\n            enumerable:false,//不能被枚举表示不能被虚幻\r\n            configurable:false,//不能删除此属性\r\n        })\r\n        //如果是一个数组\r\n        if(Array.isArray(value)){\r\n          \r\n            // 改写数组的方法\r\n            value.__proto__=ArrayMethods\r\n           \r\n            this.observeArray(value)\r\n        }else{\r\n            //分开每一步观测\r\n            this.walk(value)\r\n        }\r\n        \r\n    }\r\n    observeArray(value){\r\n        for(let i=0;i<value.length;i++){\r\n            observe(value[i])\r\n        }\r\n    }\r\n    walk(data){\r\n        //观测是目的是劫持数据\r\n        Object.keys(data).forEach(key=>{\r\n            defineReactive(data,key,data[key])\r\n        })\r\n        \r\n    }\r\n}\r\nexport  function defineReactive(data,key,value){\r\n    //如果是深层对象,value也有可能是对象\r\n    observe(value)\r\n    Object.defineProperty(data,key,{\r\n        get(){\r\n            return value;\r\n        },\r\n        set(newValue){\r\n            if(value===newValue) return;\r\n            //如果用户设置的是一个对象\r\n            observe(newValue)\r\n            value=newValue\r\n        }\r\n    })\r\n}\r\n\r\nexport default function observe(data){\r\n    //如果不是各对象直接不用观测\r\n    if(typeof data!=='object' || data==null) return;\r\n    if(data.__ob__) return;\r\n    new Observer(data)\r\n}","import observe from './observe/index'\r\nexport default function initState(vm){\r\n    //状态有很多种\r\n    if(vm.$options.data){\r\n\r\n        initData(vm)\r\n    }\r\n}\r\nfunction proxy(vm,source,key){\r\n    Object.defineProperty(vm,key,{\r\n        get(){\r\n            return vm[source][key]\r\n        },\r\n        set(newValue){\r\n            vm[source][key]=newValue\r\n        }\r\n    })\r\n}\r\nfunction initData(vm){\r\n    let data=vm.$options.data\r\n    //将vm._options属性付给vm\r\n    \r\n    data= vm._options= typeof data==='function'?data.call(vm):data\r\n    for(let key in data){\r\n        proxy(vm,'_options',key)\r\n    }\r\n    observe(data)\r\n}","import initState from \"./state\"\r\n\r\nexport default function initMixin(Vue){\r\n    Vue.prototype._init=function(options){\r\n      const vm=this;\r\n      vm.$options=options\r\n      //初始化状态\r\n      initState(vm)\r\n      //el属性\r\n      if(vm.$options.el){\r\n        this.$mount(vm.$options.el)\r\n      }\r\n    }\r\n    Vue.prototype.$mount=function(el){\r\n      el=document.querySelector(el)\r\n      const vm=this;\r\n      const options=vm.$options;\r\n\r\n      if(!options.render){\r\n        let template=options.template;\r\n        if(!template && el){\r\n          template=el.outerHtml\r\n        }\r\n        const render =compileToFunction(template)\r\n        vm.render=render\r\n      }\r\n    }\r\n}\r\n\r\n","import initMixin from \"./initMixin\"\r\n\r\nfunction Vue(options){\r\n    this._init(options)\r\n}\r\ninitMixin(Vue)\r\nexport default Vue"],"names":["oldArrayMethods","Array","prototype","ArrayMethods","Object","create","methods","forEach","method","args","result","call","inserted","slice","__ob__","observeArray","Observer","value","defineProperty","enumerable","configurable","isArray","__proto__","walk","i","length","observe","data","keys","key","defineReactive","get","set","newValue","initState","vm","$options","initData","proxy","source","_options","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","template","outerHtml","compileToFunction"],"mappings":"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"}